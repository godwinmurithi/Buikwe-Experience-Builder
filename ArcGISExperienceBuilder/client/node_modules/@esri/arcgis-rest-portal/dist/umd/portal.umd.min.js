/* @preserve
* @esri/arcgis-rest-portal - v3.5.1 - Apache-2.0
* Copyright (c) 2017-2022 Esri, Inc.
* Thu Dec 01 2022 07:17:07 GMT-0800 (Pacific Standard Time)
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@esri/arcgis-rest-request")):"function"==typeof define&&define.amd?define(["exports","@esri/arcgis-rest-request"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).arcgisRest=e.arcgisRest||{},e.arcgisRest)}(this,function(e,u){"use strict";var a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e){return void 0===e&&(e={}),e.portal?u.cleanUrl(e.portal):e.authentication?e.authentication.portal:"https://www.arcgis.com/sharing/rest"}function n(e){var t=JSON.parse(JSON.stringify(e));return t.data&&("undefined"!=typeof Blob&&e.data instanceof Blob||"ReadStream"===e.data.constructor.name?t.file=e.data:t.text=e.data,delete t.data),t}function c(e){return e.owner?Promise.resolve(e.owner):e.item&&e.item.owner?Promise.resolve(e.item.owner):e.authentication&&e.authentication.getUsername?e.authentication.getUsername():Promise.reject(new Error("Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option."))}function o(e){return Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[1])}function i(e){return e.join(",")}function t(t){return c(t).then(function(e){e=t.folderId?s(t)+"/content/users/"+e+"/"+t.folderId+"/items/"+t.item.id+"/update":s(t)+"/content/users/"+e+"/items/"+t.item.id+"/update";return t.params=a(a({},t.params),n(t.item)),t.params.extent&&o(t.params.extent)&&(t.params.extent=i(t.params.extent)),t.params.file&&t.params.file.constructor&&"ReadStream"===t.params.file.constructor.name&&(t.params.dataSize=t.dataSize),u.request(e,t)})}function r(r){return r.multipart&&!r.filename?Promise.reject(new Error("The filename is required for a multipart request.")):c(r).then(function(e){var t=s(r)+"/content/users/"+e,e=t+"/addItem";r.folderId&&(e=t+"/"+r.folderId+"/addItem"),r.params=a(a({},r.params),n(r.item)),r.params.extent&&o(r.params.extent)&&(r.params.extent=i(r.params.extent));t=u.appendCustomParams(r,["owner","folderId","file","dataUrl","text","async","multipart","filename","overwrite"],{params:a({},r.params)});return u.request(e,t)})}var m=/[\x00-\x1F\x7F-\x9F\xA0]/g;function p(e){return e.replace(m,"")}var d=function(e,t){return("string"==typeof t?t:s(t))+"/content/items/"+e};function h(e,t){var r=t||{},n=r.fileName,r=r.readAs;return f(e,"/info/"+(void 0===n?"iteminfo.xml":n),void 0===r?"text":r,a({httpMethod:"GET"},t))}function f(e,t,r,n){var t=""+d(e,n)+t,n=a({params:{}},n),o=n.rawResponse;return n.rawResponse=!0,n.params.f=null,u.request(t,n).then(function(e){return o?e:"json"!==r?e[r]():e.text().then(function(e){return JSON.parse(p(e))})})}function l(e,t){e=s(t)+"/community/groups/"+e,t=a({httpMethod:"GET"},t);return u.request(e,t)}function g(e){var t=e.authentication.username,t=e.owner||t;return s(e)+"/content/users/"+encodeURIComponent(t)+"/items/"+e.id+"/share"}function v(e){var t=e.authentication.username;return(e.owner||t)===t}function y(e){return e.authentication.getUser(e).then(function(e){return e&&"org_admin"===e.role&&!e.roleId})}function I(e){return l(e.groupId,e).then(function(e){return e.userMembership.memberType}).catch(function(){return"none"})}var q=(w.prototype.match=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.termStack=this.termStack.concat(e),this},w.prototype.in=function(e){var t="`in("+(e?'"'+e+'"':"")+")`";return this.hasRange||this.hasTerms?(e&&"*"!==e&&(this.q+=e+":"),this.commit()):(u.warn(t+" was called with no call to `match(...)` or `from(...)`/`to(...)`. Your query was not modified."),this)},w.prototype.startGroup=function(){return this.commit(),0<this.openGroups&&(this.q+=" "),this.openGroups++,this.q+="(",this},w.prototype.endGroup=function(){return this.openGroups<=0?u.warn("`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified."):(this.commit(),this.openGroups--,this.q+=")"),this},w.prototype.and=function(){return this.addModifier("and")},w.prototype.or=function(){return this.addModifier("or")},w.prototype.not=function(){return this.addModifier("not")},w.prototype.from=function(e){return this.hasTerms?u.warn('`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.'):this.rangeStack[0]=e,this},w.prototype.to=function(e){return this.hasTerms?u.warn('`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.'):this.rangeStack[1]=e,this},w.prototype.boost=function(e){return this.commit(),this.q+="^"+e,this},w.prototype.toParam=function(){return this.commit(),this.cleanup(),this.q},w.prototype.clone=function(){return this.commit(),this.cleanup(),new w(this.q+"")},w.prototype.addModifier=function(e){return this.currentModifer?(u.warn("You have called `"+this.currentModifer+"()` after `"+e+"()`. Your current query was not modified."),this):(this.commit(),""===this.q&&"not"!==e?u.warn("You have called `"+e+"()` without calling another method to modify your query first. Try calling `match()` first."):(this.currentModifer=e,this.q+=""===this.q?"":" ",this.q+=e.toUpperCase()+" "),this)},w.prototype.needsQuotes=function(e){return/\s|:/g.test(e)},w.prototype.formatTerm=function(e){return e instanceof Date?e.getTime():"string"==typeof e&&this.needsQuotes(e)?'"'+e+'"':e},w.prototype.commit=function(){var t=this;return this.currentModifer=void 0,this.hasRange&&(this.q+="["+this.formatTerm(this.rangeStack[0])+" TO "+this.formatTerm(this.rangeStack[1])+"]",this.rangeStack=[void 0,void 0]),this.hasTerms&&(this.q+=this.termStack.map(function(e){return t.formatTerm(e)}).join(" "),this.termStack=[]),this},Object.defineProperty(w.prototype,"hasTerms",{get:function(){return 0<this.termStack.length},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasRange",{get:function(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]},enumerable:!1,configurable:!0}),w.prototype.cleanup=function(){if(0<this.openGroups)for(u.warn("Automatically closing "+this.openGroups+" group(s). You can use `endGroup(...)` to remove this warning.");0<this.openGroups;)this.q+=")",this.openGroups--;var e=this.q;this.q=e.replace(/( AND ?| NOT ?| OR ?)*$/,""),e!==this.q&&u.warn("`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified."),this.q=this.q.replace(/(\(\))*/,"")},w);function w(e){void 0===e&&(e=""),this.termStack=[],this.rangeStack=[],this.openGroups=0,this.q=e}function b(r,n){var e,t="string"==typeof r||r instanceof q?{httpMethod:"GET",params:{q:r}}:u.appendCustomParams(r,["q","num","start","sortField","sortOrder","searchUserAccess","searchUserName","filter","countFields","countSize","categories","categoryFilters"],{httpMethod:"GET"});switch(n){case"item":e="/search";break;case"group":e="/community/groups";break;case"groupContent":if("string"==typeof r||r instanceof q||!r.groupId)return Promise.reject(new Error("you must pass a `groupId` option to `searchGroupContent`"));e="/content/groups/"+r.groupId+"/search";break;default:e="/portals/self/users/search"}var o=s(t)+e;return u.request(o,t).then(function(t){return t.nextStart&&-1!==t.nextStart&&(t.nextPage=function(){var e;return"string"==typeof r||r instanceof q?e={q:r,start:t.nextStart}:(e=r).start=t.nextStart,b(e,n)}),t})}function T(e){return b(e,"item")}function G(e,t){if(0===e.length)return[];for(var r=[],n=0;n<e.length;n+=t)r.push(e.slice(n,n+t));return r}function U(e){var t=e.id,r=s(e)+"/community/groups/"+t+"/addUsers",t=Object.assign({},e,{admins:void 0,users:void 0}),t=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],a=0,u=i.length;a<u;a++,o++)n[o]=i[a];return n}(x("users",e.users,t),x("admins",e.admins,t)).map(function(e){return t=r,e=e,u.request(t,e).catch(function(e){return{errors:[e]}});var t});return Promise.all(t).then(P)}function x(o,e,i){return!e||e.length<1?[]:G(e,25).map(function(e){return t=o,r=e,n=i,Object.assign({},n,((e={})[t]=r,e.params=a(a({},n.params),((n={})[t]=r,n)),e));var t,r,n})}function P(e){var t=e.filter(function(e){return e.notAdded}).reduce(function(e,t){return e.concat(t.notAdded)},[]),e=e.filter(function(e){return e.errors}).reduce(function(e,t){return e.concat(t.errors)},[]),t={notAdded:t};return 0<e.length&&(t.errors=e),t}function S(t){var e=t.id,r=t.users,n=s(t)+"/community/groups/"+e+"/removeUsers",r=G(r,25).map(function(e){e=a(a({},t),{users:e,params:{users:e}});return u.request(n,e).catch(function(e){return{errors:[e]}})});return Promise.all(r).then(function(e){var t=function(r){return e.filter(function(e){return e[r]}).reduce(function(e,t){return e.concat(t[r])},[])},r=t("errors"),t={notRemoved:t("notRemoved")};return r.length?a(a({},t),{errors:r}):t})}function C(e){var t=e.every(function(e){return e.success}),e=e.reduce(function(e,t){return e.concat(t.errors||[])},[]),t={success:t};return 0<e.length&&(t.errors=e),t}function M(e){var t=s(e)+"/community/groups/"+e.id+"/updateUsers",r={authentication:e.authentication,params:{}};return"admin"===e.newMemberType?r.params.admins=e.users:r.params.users=e.users,u.request(t,r)}function E(e){var t=e.every(function(e){return e.success}),e=e.reduce(function(e,t){return e.concat(t.errors||[])},[]),t={success:t};return 0<e.length&&(t.errors=e),t}function R(e){var t,r,n={httpMethod:"GET"};return"string"==typeof e?r="https://www.arcgis.com/sharing/rest/community/users/"+e:(t=e.username||e.authentication.username,r=s(e)+"/community/users/"+encodeURIComponent(t),n=a(a({},e),n)),u.request(r,n)}function A(e,t){return t.params=a({org:!1,everyone:!1},t.params),"private"===t.access&&(t.params.groups=" "),"org"===t.access&&(t.params.org=!0),"public"===t.access&&(t.params.account=!0,t.params.everyone=!0),u.request(e,t)}function N(t){return T({q:"id: "+t.id+" AND group: "+t.groupId,start:1,num:10,sortField:"title",authentication:t.authentication,httpMethod:"POST"}).then(function(e){if(0<e.total)return e.results.some(function(e){return e.id===t.id})})}function O(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var n=e.authentication.username,o=e.owner||n,i=s(e)+"/content/items/"+e.id+"/share";return(o===n||t&&!r)&&(i=s(e)+"/content/users/"+o+"/items/"+e.id+"/share"),e.params={groups:e.groupId,confirmItemControl:e.confirmItemControl},u.request(i,e)}function j(e,t,r,n,o){var i,a,u=t.groups||[],s=u.find(function(e){return e.id===o.groupId});if(e.orgId!==t.orgId)throw Error("User "+t.username+" is not a member of the same org as "+e.username+". Consequently they can not be added added to group "+o.groupId+" nor can item "+o.id+" be shared to the group.");if(!s&&511<u.length)throw Error("User "+t.username+" already has 512 groups, and can not be added to group "+o.groupId+". Consequently item "+o.id+" can not be shared to the group.");return a=s?r&&"member"===s.userMembership.memberType?(i=M({id:o.groupId,users:[t.username],newMemberType:"admin",authentication:o.authentication}).then(function(e){e=e.results.reduce(function(e,t){return t.success||e.push(t.username),e},[]);return Promise.resolve({notAdded:e})}).catch(function(){return{notAdded:[t.username]}}),function(e){return M({id:o.groupId,users:[t.username],newMemberType:"member",authentication:o.authentication}).then(function(){return e}).catch(function(){return e})}):(i=Promise.resolve({notAdded:[]}),function(e){return Promise.resolve(e)}):(r=r?"admins":"users",i=U(((a={id:o.groupId})[r]=[t.username],a.authentication=o.authentication,a)).then(function(e){if(e.errors&&e.errors.length)throw e.errors[0];return e}).catch(function(){return{notAdded:[t.username]}}),function(e){return S({id:o.groupId,users:[t.username],authentication:o.authentication}).then(function(){return e})}),{promise:i.then(function(e){if(e.notAdded.length)throw new Error(n);return e}),revert:a}}function k(e,t,r){var n=r.portal+"/portals/self/isServiceNameAvailable";return u.request(n,{params:{name:e,type:t},httpMethod:"GET",authentication:r})}function F(e,t){e=e||"self",e=s(t)+"/portals/"+e,t=a({httpMethod:"GET"},t);return u.request(e,t)}e.SearchQueryBuilder=q,e.acceptInvitation=function(e){var t=encodeURIComponent(e.authentication.username),t=s(e)+"/community/users/"+t+"/invitations/"+e.invitationId+"/accept",e=a({},e);return u.request(t,e)},e.addGroupUsers=U,e.addItemData=function(e){return delete(e=a({item:{id:e.id,data:e.data}},e)).id,delete e.data,t(e)},e.addItemPart=function(r){var n=r.partNum;return!Number.isInteger(n)||n<1||1e4<n?Promise.reject(new Error("The part number must be an integer between 1 to 10000, inclusive.")):c(r).then(function(e){var t=s(r)+"/content/users/"+e+"/items/"+r.id+"/addPart?partNum="+n,e=u.appendCustomParams(r,["file"],{params:a({},r.params)});return u.request(t,e)})},e.addItemRelationship=function(r){return c(r).then(function(e){var t=s(r)+"/content/users/"+e+"/addRelationship",e=u.appendCustomParams(r,["originItemId","destinationItemId","relationshipType"],{params:a({},r.params)});return u.request(t,e)})},e.addItemResource=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/items/"+t.id+"/addResources";return t.params=a({file:t.resource,fileName:t.name,resourcesPrefix:t.prefix,text:t.content,access:t.private?"private":"inherit"},t.params),u.request(e,t)})},e.bboxToString=i,e.cancelItemUpload=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/items/"+t.id+"/cancel";return u.request(e,t)})},e.commitItemUpload=function(r){return c(r).then(function(e){var t=s(r)+"/content/users/"+e+"/items/"+r.id+"/commit",e=u.appendCustomParams(r,[],{params:a(a({},r.params),n(r.item))});return u.request(t,e)})},e.createFolder=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/createFolder";return t.params=a({title:t.title},t.params),u.request(e,t)})},e.createGroup=function(e){var t=s(e)+"/community/createGroup";return e.params=a(a({},e.params),e.group),u.request(t,e)},e.createGroupNotification=function(e){var t=s(e)+"/community/groups/"+e.id+"/createNotification",e=a({params:a({subject:e.subject,message:e.message,users:e.users,notificationChannelType:e.notificationChannelType||"email",clientId:e.clientId,silentNotification:e.silentNotification,notifyAll:!e.users||0===e.users.length},e.params)},e);return u.request(t,e)},e.createItem=function(e){return r(a({folderId:null},e))},e.createItemInFolder=r,e.createOrgNotification=function(e){var n,r=s(e)+"/portals/self/createNotification",e=G((n=e).users,n.batchSize||25).map(function(e){return t=e,r=n,(e=Object.assign({},r)).params=a(a({},e.params),{users:t,subject:r.subject,message:r.message,notificationChannelType:e.notificationChannelType}),e;var t,r}).map(function(e){return t=r,e=e,u.request(t,e).catch(function(e){return{errors:[e]}});var t});return Promise.all(e).then(E)},e.declineInvitation=function(e){var t=encodeURIComponent(e.authentication.username),t=s(e)+"/community/users/"+t+"/invitations/"+e.invitationId+"/decline",e=a({},e);return u.request(t,e)},e.determineOwner=c,e.ensureMembership=j,e.exportItem=function(t){var r=t.authentication,n=t.id,o=t.title,i=t.exportFormat,a=t.exportParameters;return c(t).then(function(e){return s(t)+"/content/users/"+e+"/export"}).then(function(e){return u.request(e,{httpMethod:"POST",authentication:r,params:{itemId:n,title:o,exportFormat:i,exportParameters:a}})})},e.getGroup=l,e.getGroupCategorySchema=function(e,t){return e=s(t)+"/community/groups/"+e+"/categorySchema",t=a({httpMethod:"GET"},t),u.request(e,t)},e.getGroupContent=function(e,t){var r=s(t)+"/content/groups/"+e,e=a(a({httpMethod:"GET"},{params:{start:1,num:100}}),t);return t&&t.paging&&(e.params=a({},t.paging)),u.request(r,e)},e.getGroupUsers=function(e,t){return e=s(t)+"/community/groups/"+e+"/users",t=a({httpMethod:"GET"},t),u.request(e,t)},e.getItem=function(e,t){return e=d(e,t),t=a({httpMethod:"GET"},t),u.request(e,t)},e.getItemBaseUrl=d,e.getItemData=function(e,t){return e=d(e,t)+"/data",(t=a({httpMethod:"GET",params:{}},t)).file&&(t.params.f=null),u.request(e,t).catch(function(e){var t=RegExp(/The string did not match the expected pattern|(Unexpected end of (JSON input|data at line 1 column 1))/i);if(!t.test(e.message))throw e})},e.getItemGroups=function(e,t){return e=d(e,t)+"/groups",u.request(e,t)},e.getItemInfo=h,e.getItemMetadata=function(e,t){return h(e,a(a({},t),{fileName:"metadata/metadata.xml"}))},e.getItemParts=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/items/"+t.id+"/parts";return u.request(e,t)})},e.getItemResource=function(e,t){var r=t.readAs||"blob";return f(e,"/resources/"+t.fileName,r,t)},e.getItemResources=function(e,t){return e=d(e,t)+"/resources",(t=a({},t)).params=a({num:1e3},t.params),u.request(e,t)},e.getItemStatus=function(r){return c(r).then(function(e){var t=s(r)+"/content/users/"+e+"/items/"+r.id+"/status",e=u.appendCustomParams(r,["jobId","jobType"],{params:a({},r.params)});return u.request(t,e)})},e.getPortal=F,e.getPortalSettings=function(e,t){return e=e||"self",e=s(t)+"/portals/"+e+"/settings",t=a({httpMethod:"GET"},t),u.request(e,t)},e.getPortalUrl=s,e.getRelatedItems=function(e){var t=d(e.id,e)+"/relatedItems",r=a({httpMethod:"GET",params:{direction:e.direction}},e);return"string"==typeof e.relationshipType?r.params.relationshipType=e.relationshipType:r.params.relationshipTypes=e.relationshipType,delete r.direction,delete r.relationshipType,u.request(t,r)},e.getSelf=function(e){return F(null,e)},e.getSharingUrl=g,e.getSubscriptionInfo=function(e,t){return e=e||"self",e=s(t)+"/portals/"+e+"/subscriptionInfo",t=a({httpMethod:"GET"},t),u.request(e,t)},e.getUniqueServiceName=function t(r,n,o,i){var a=i?r+"_"+i:r;return k(a,n,o).then(function(e){return e.available?a:t(r,n,o,i+=1)})},e.getUser=R,e.getUserContent=function(t){var e=t.folderId,r=t.start,n=void 0===r?1:r,r=t.num,o=void 0===r?10:r,i=t.authentication,a=e?"/"+e:"";return c(t).then(function(e){return s(t)+"/content/users/"+e+a}).then(function(e){return u.request(e,{httpMethod:"GET",authentication:i,params:{start:n,num:o}})})},e.getUserInvitation=function(e){var t=encodeURIComponent(e.authentication.username),r=s(e)+"/community/users/"+t+"/invitations/"+e.invitationId,t={httpMethod:"GET"},t=a(a({},e),t);return u.request(r,t)},e.getUserInvitations=function(e){var t={httpMethod:"GET"},r=encodeURIComponent(e.authentication.username),r=s(e)+"/community/users/"+r+"/invitations",t=a(a({},e),t);return u.request(r,t)},e.getUserMembership=I,e.getUserNotifications=function(e){var t={httpMethod:"GET"},r=encodeURIComponent(e.authentication.username),r=s(e)+"/community/users/"+r+"/notifications",t=a(a({},e),t);return u.request(r,t)},e.getUserTags=function(e){var t=e.username||e.authentication.username,t=s(e)+"/community/users/"+encodeURIComponent(t)+"/tags";return u.request(t,e)},e.getUserUrl=function(e){return s(e)+"/community/users/"+encodeURIComponent(e.username)},e.inviteGroupUsers=function(e){var t,r=e.id,n=s(e)+"/community/groups/"+r+"/invite",e=G((t=e).users,25).map(function(e){return function(e,t){t=Object.assign({},t);return t.params=a(a({},t.params),{users:e,role:t.role,expiration:t.expiration}),t}(e,t)}).map(function(e){return t=n,e=e,u.request(t,e).catch(function(e){return{errors:[e]}});var t});return Promise.all(e).then(C)},e.isBBox=o,e.isItemOwner=v,e.isItemSharedWithGroup=N,e.isOrgAdmin=y,e.isServiceNameAvailable=k,e.joinGroup=function(e){var t=s(e)+"/community/groups/"+e.id+"/join";return u.request(t,e)},e.leaveGroup=function(e){var t=s(e)+"/community/groups/"+e.id+"/leave";return u.request(t,e)},e.moveItem=function(r){return c(r).then(function(e){var t=s(r)+"/content/users/"+e+"/items/"+r.itemId+"/move",e=(e=r.folderId)||"/";return r.params=a({folder:e},r.params),u.request(t,r)})},e.protectGroup=function(e){var t=s(e)+"/community/groups/"+e.id+"/protect";return u.request(t,e)},e.protectItem=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/items/"+t.id+"/protect";return u.request(e,t)})},e.reassignItem=function(r){return y(r).then(function(e){if(!e)throw Error("Item "+r.id+" can not be reassigned because current user is not an organization administrator.");var t=s(r)+"/content/users/"+r.currentOwner+"/items/"+r.id+"/reassign",e={params:{targetUsername:r.targetUsername,targetFolderName:r.targetFolderName},authentication:r.authentication};return u.request(t,e)})},e.removeFolder=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+encodeURIComponent(e)+"/"+t.folderId+"/delete";return u.request(e,t)})},e.removeGroup=function(e){var t=s(e)+"/community/groups/"+e.id+"/delete",e=a({},e);return u.request(t,e)},e.removeGroupUsers=S,e.removeItem=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/items/"+t.id+"/delete";return u.request(e,t)})},e.removeItemRelationship=function(r){return c(r).then(function(e){var t=s(r)+"/content/users/"+e+"/deleteRelationship",e=u.appendCustomParams(r,["originItemId","destinationItemId","relationshipType"],{params:a({},r.params)});return u.request(t,e)})},e.removeItemResource=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/items/"+t.id+"/removeResources";return t.params=a(a({},t.params),{resource:t.resource}),void 0!==t.deleteAll&&(t.params.deleteAll=t.deleteAll),u.request(e,t)})},e.removeNotification=function(e){var t=encodeURIComponent(e.authentication.username),t=s(e)+"/community/users/"+t+"/notifications/"+e.id+"/delete";return u.request(t,e)},e.scrubControlChars=p,e.searchGroupContent=function(e){return b(e,"groupContent")},e.searchGroupUsers=function(e,t){return e=s(t)+"/community/groups/"+e+"/userlist",t=u.appendCustomParams(t||{},["name","num","start","sortField","sortOrder","joined","memberType"],{httpMethod:"GET"}),u.request(e,t)},e.searchGroups=function(e){return b(e,"group")},e.searchItems=T,e.searchUsers=function(e){return b(e,"user")},e.serializeItem=n,e.setItemAccess=function(t){var r=g(t);return v(t)?A(r,t):y(t).then(function(e){if(e)return A(r,t);throw Error("This item can not be shared by "+t.authentication.username+". They are neither the item owner nor an organization admin.")})},e.shareItemWithGroup=function(u){return N(u).then(function(e){if(e)return{itemId:u.id,shortcut:!0,notSharedWith:[]};var t=u.authentication.username,e=u.owner,o=u.confirmItemControl,e=e||t;if(e===t)return O(u);var i=!1,a=!1;return Promise.all([R({username:t,authentication:u.authentication}),R({username:e,authentication:u.authentication}),I(u)]).then(function(e){var t=e[0],r=e[1],n=e[2],e=!!o;return i="org_admin"===t.role&&!t.roleId,a=t.orgId!==r.orgId,function(e,t,r,n,o,i){var a=[];if(i.groupId!==e.favGroupId)if(t){if(!n)throw Error("This item can not be shared to shared editing group "+i.groupId+" by "+e.username+" as they not the item owner or org admin.");a.push(j(e,e,!1,"Error adding "+e.username+" as member to edit group "+i.groupId+". Consequently item "+i.id+" was not shared to the group.",i),j(e,o,!0,"none"===r?"Error adding user "+o.username+" to edit group "+i.groupId+". Consequently item "+i.id+" was not shared to the group.":"Error promoting user "+o.username+" to admin in edit group "+i.groupId+". Consequently item "+i.id+" was not shared to the group.",i))}else if(n)a.push(j(e,e,!1,"Error adding "+e.username+" as member to view group "+i.groupId+". Consequently item "+i.id+" was not shared to the group.",i));else if("none"===r)throw new Error("This item can not be shared by "+e.username+" as they are not a member of the specified group "+i.groupId+".");return a}(t,e,n,i,r,u)}).then(function(e){var t=e[0],r=(void 0===t?{promise:Promise.resolve({notAdded:[]}),revert:function(e){return Promise.resolve(e)}}:t).revert;return Promise.all(e.map(function(e){return e.promise})).then(function(){return O(u,i,a)}).then(function(e){return r(e)})})}).then(function(e){if(e.notSharedWith.length)throw Error("Item "+u.id+" could not be shared to group "+u.groupId+".");return e})},e.unprotectGroup=function(e){var t=s(e)+"/community/groups/"+e.id+"/unprotect";return u.request(t,e)},e.unprotectItem=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/items/"+t.id+"/unprotect";return u.request(e,t)})},e.unshareItemWithGroup=function(i){return N(i).then(function(e){if(!e)return Promise.resolve({itemId:i.id,shortcut:!0,notUnsharedFrom:[]});var n=i.authentication.username,o=i.owner;return Promise.all([I(i),R({username:n,authentication:i.authentication})]).then(function(e){var t=e[0],r=e[1],e=(o||n)===n,r="org_admin"===r.role&&!r.roleId;if(!e&&!r&&["admin","owner"].indexOf(t)<0)throw Error("This item can not be unshared from group "+i.groupId+" by "+n+" as they not the item owner, an org admin, group admin or group owner.");return function(e){var t=e.authentication.username,r=e.owner||t,n=s(e)+"/content/items/"+e.id+"/unshare";r===t&&(n=s(e)+"/content/users/"+r+"/items/"+e.id+"/unshare");return e.params={groups:e.groupId},u.request(n,e)}(i)}).then(function(e){if(e.notUnsharedFrom.length)throw Error("Item "+i.id+" could not be unshared to group "+i.groupId);return e})})},e.updateGroup=function(e){var t=s(e)+"/community/groups/"+e.group.id+"/update";return e.params=a(a({},e.params),e.group),u.request(t,e)},e.updateItem=t,e.updateItemInfo=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/items/"+t.id+"/updateinfo";return t.params=a({folderName:t.folderName,file:t.file},t.params),u.request(e,t)})},e.updateItemResource=function(t){return c(t).then(function(e){e=s(t)+"/content/users/"+e+"/items/"+t.id+"/updateResources";return t.params=a({file:t.resource,fileName:t.name,resourcesPrefix:t.prefix,text:t.content},t.params),void 0!==t.private&&(t.params.access=t.private?"private":"inherit"),u.request(e,t)})},e.updateUser=function(e){var t=e.user.username||e.authentication.username,t=s(e)+"/community/users/"+encodeURIComponent(t)+"/update";return e.params=a(a({},e.user),e.params),delete e.user,u.request(t,e)},e.updateUserMemberships=M,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=portal.umd.min.js.map
