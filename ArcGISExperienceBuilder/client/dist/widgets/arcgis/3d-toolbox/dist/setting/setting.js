System.register(["jimu-core","jimu-theme","jimu-ui","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-arcgis","jimu-ui/advanced/map","esri/analysis/SlicePlane","esri/analysis/SliceAnalysis","esri/Viewpoint","esri/core/reactiveUtils"],(function(e,t){var a={},n={},i={},o={},s={},l={},c={},r={},d={},u={},g={},m={};return{setters:[function(e){a.APP_FRAME_NAME_IN_BUILDER=e.APP_FRAME_NAME_IN_BUILDER,a.Immutable=e.Immutable,a.LayoutType=e.LayoutType,a.React=e.React,a.ReactRedux=e.ReactRedux,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.jsx=e.jsx,a.polished=e.polished},function(e){n.useTheme=e.useTheme},function(e){i.Button=e.Button,i.FloatingPanel=e.FloatingPanel,i.Icon=e.Icon,i.Label=e.Label,i.NumericInput=e.NumericInput,i.Radio=e.Radio,i.Select=e.Select,i.Switch=e.Switch,i.defaultMessages=e.defaultMessages,i.hooks=e.hooks},function(e){o.getAppConfigAction=e.getAppConfigAction},function(e){s.DirectionSelector=e.DirectionSelector,s.MapWidgetSelector=e.MapWidgetSelector,s.SettingCollapse=e.SettingCollapse,s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper},function(e){l.List=e.List,l.TreeItemActionType=e.TreeItemActionType},function(e){c.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.JimuMap=e.JimuMap},function(e){d.default=e.default},function(e){u.default=e.default},function(e){g.default=e.default},function(e){m.default=e.default}],execute:function(){e((()=>{var e={748:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5Zm-9 0a3.501 3.501 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5ZM15.5 11l-5 1-3 4-1-9.5 9 4.5Zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38-2.517.503Z" fill="#000"></path></svg>'},41553:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35.151.722.257 1.34.316 1.852.374.16.725.362 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 21.98 21.98 0 0 1-1.49 1.194 5.17 5.17 0 0 1-.007 1.183l1.464 1.119a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 22.445 22.445 0 0 1-1.807-.66c-.325.233-.679.43-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21.019 21.019 0 0 1-.317-1.853 5.34 5.34 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546c.567-.49 1.063-.888 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196c.719.233 1.321.453 1.807.66.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994h2.839Zm-.365 1H6.985l-.28 1.866-.467.19c-.235.095-.46.21-.672.34l-.207.136-.42.293-.476-.197c-.328-.137-.718-.281-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4.127 4.127 0 0 0-.021.816l.014.144.058.492-.419.294c-.288.203-.615.451-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29c.204.146.42.274.645.384l.228.103.474.199.059.49c.04.338.103.731.19 1.177l.043.219h2.088l.282-1.867.466-.19c.236-.095.46-.21.672-.34l.207-.136.419-.293.476.198c.33.136.72.28 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4.131 4.131 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18.1 18.1 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.496 4.496 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49c-.032-.27-.08-.576-.14-.916l-.094-.48Zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" fill="#000"></path></svg>'},59216:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.226 1.312c-.403-.404-1.044-.417-1.431-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431l-1.462-1.462Zm-8.113 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991-1.781.32Zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402 1.461 1.461Z" fill="#000"></path><path d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="#000"></path></svg>'},99142:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTIiIGhlaWdodD0iNTYiIHZpZXdCb3g9IjAgMCA5MiA1NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxyZWN0IHdpZHRoPSI5MiIgaGVpZ2h0PSI1NiIgZmlsbD0iIzI4MjgyOCIvPg0KPGNpcmNsZSBjeD0iMTQiIGN5PSIxNCIgcj0iNSIgZmlsbD0iIzZBNkE2QSIvPg0KPGNpcmNsZSBjeD0iMTQiIGN5PSIyOCIgcj0iNSIgZmlsbD0iIzZBNkE2QSIvPg0KPGNpcmNsZSBjeD0iMTQiIGN5PSI0MiIgcj0iNSIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMjYiIHk9IjEyIiB3aWR0aD0iMjciIGhlaWdodD0iNCIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMjYiIHk9IjI2IiB3aWR0aD0iNDIiIGhlaWdodD0iNCIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMjYiIHk9IjQwIiB3aWR0aD0iNTMiIGhlaWdodD0iNCIgZmlsbD0iIzZBNkE2QSIvPg0KPC9zdmc+DQo="},67113:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA4IiBoZWlnaHQ9IjcyIiB2aWV3Qm94PSIwIDAgMTA4IDcyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iMjMiIHk9IjI2IiB3aWR0aD0iNjIiIGhlaWdodD0iMjAiIGZpbGw9IiMyODI4MjgiLz4NCjxyZWN0IHg9IjMyIiB5PSIzMCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiByeD0iNiIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iNDgiIHk9IjMwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHJ4PSI2IiBmaWxsPSIjNkE2QTZBIi8+DQo8cmVjdCB4PSI2NCIgeT0iMzAiIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgcng9IjYiIGZpbGw9IiM2QTZBNkEiLz4NCjwvc3ZnPg0K"},67489:e=>{"use strict";e.exports=g},74871:e=>{"use strict";e.exports=u},29962:e=>{"use strict";e.exports=d},135:e=>{"use strict";e.exports=m},26826:e=>{"use strict";e.exports=c},48891:e=>{"use strict";e.exports=a},23137:e=>{"use strict";e.exports=o},34796:e=>{"use strict";e.exports=n},30726:e=>{"use strict";e.exports=i},58290:e=>{"use strict";e.exports=r},77756:e=>{"use strict";e.exports=s},59587:e=>{"use strict";e.exports=l}},t={};function p(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,p),i.exports}p.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return p.d(t,{a:t}),t},p.d=(e,t)=>{for(var a in t)p.o(t,a)&&!p.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},p.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p.p="";var h={};return p.p=window.jimuConfig.baseUrl,(()=>{"use strict";p.r(h),p.d(h,{default:()=>K});var e=p(48891),t=p(34796),a=p(30726),n=p(23137),i=p(77756);const o={selectMapWidget:"Select a Map widget",arrangementStyle:"Arrangement style",activedOnLoad:"Active tool when widget load",timezoneSelector:"Timezone selector",timeSliderSteps:"Time slider steps",dateSelector:"Date selector",defaultSeason:"Default season",syncedWithMap:"Synchronized with map",spring:"Spring",summer:"Summer",fall:"Fall",winter:"Winter",autoYearlyPlay:"Auto yearly play",daytimePlaySpeed:"Daytime play speed",shadowOption:"Shadow option",dateTimeOption:"Date time option",defaultWeather:"Default weather",sunny:"Sunny",cloudy:"Cloudy",rainy:"Rainy",snowy:"Snowy",foggy:"Foggy",defaultValues:"Default values",cloudCover:"Cloud cover",precipitation:"Precipitation",sunnyDay:"Sunny day",cloudyDay:"Cloudy day",rainyDay:"Rainy day",snowyDay:"Snowy day",snowCover:"Snow cover",foggyDay:"Foggy day",fogStrength:"Fog density",defaultAnalysisType:"Default analysis type",threshold:"Above threshold",duration:"Total duration",discrete:"Discrete shadow",colorSchema:"Color schema",observePoint:"Observe Point",markIntersections:"Mark Intersections",markPoint:"Mark Point",excludeGroundSurface:"Allow excluding ground",tiltEnabled:"Allow slice place tilt",defaultSlice:"Default slice",setDefaultSlice:"Set default slice",savePopper:"Save",savedState:"Saved",yesBtn:"Yes",closePopper:"Close",confirmInfo:"You have unsaved changes, do you want to close?"};function s(t){const a=t.colors.palette.light[200];return e.css`
      font-size: 13px;
      font-weight: lighter;

      .jimu-widget-setting--section {
        padding: 18px 16px;
      }

      /* ToolsContainer */
      .jimu-tree {
        .jimu-tree-item {
          .jimu-tree-item__content {
            .jimu-tree-item__body {
              background-color: transparent;

              .jimu-tree-item__title-text {
                /* for Safari ,#9889 */
                -webkit-line-clamp: 1;
                word-break: keep-all;
              }
            }
          }
        }
      }

      /* Arrangement ui-mode */
      .ui-mode-setting {
        display: flex;
      }

      .ui-mode-card-chooser{
        display: flex;
        align-items: start;

        .ui-mode-card-wapper {
          width: calc((100% - ${10}px - ${8}px) / 2);
        }

        .ui-mode-card-separator {
          width: ${10}px
        }
        .ui-mode-card {
          flex: 1;
          width: 100%;
          background: ${a};
          border: ${2}px solid ${a};
          margin: 0 0 0.5rem 0;

          .jimu-icon {
            margin: 0
          }
        }
        .ui-mode-card.active {
          border: ${2}px solid #00D8ED;
          background-color: ${a} !important;
        }
        .ui-mode-label {
          overflow: hidden;
          text-align: center;
        }
      }

      .placeholder-container{
        height: calc(100% - 180px);

        .placeholder-icon{
          color: var(--dark-200);
        }
        .placeholder-hint{
          font-size: ${e.polished.rem(14)};
          font-weight: 500;
          color: var(--dark-500);
          max-width: ${e.polished.rem(160)};
        }
      }
  `}var l,c,r,d,u,g,m;!function(e){e.Daylight="daylight",e.Weather="weather",e.ShadowCast="shadowcast",e.LineOfSight="lineofsight",e.Slice="slice"}(l||(l={})),function(e){e.Date="date",e.Season="season"}(c||(c={})),function(e){e.SyncedWithMap="syncedWithMap",e.Spring="spring",e.Summer="summer",e.Fall="fall",e.Winter="winter"}(r||(r={})),function(e){e.Sunny="sunny",e.Cloudy="cloudy",e.Rainy="rainy",e.Snowy="snowy",e.Foggy="foggy"}(d||(d={})),function(e){e.Threshold="threshold",e.Duration="duration",e.Discrete="discrete"}(u||(u={})),function(e){e.List="list",e.Icon="icon"}(g||(g={})),function(e){e.Horizontal="horizontal",e.Vertical="vertical"}(m||(m={}));var f=p(59587),S=p(41553),x=p.n(S);const y=e.React.memo((t=>{const n=a.hooks.useTranslate(o,a.defaultMessages),s=t.onSidePopperToggle,c=e.React.useCallback(((e,t)=>{s(e.id,t.event.target)}),[s]),r=e.React.useCallback((e=>(null==e?void 0:e.map((e=>{const t=e.enable,a=[{label:n("edit"),iconProps:()=>({icon:x()}),action:t=>{c(e,t)}}];return{itemKey:e.id,itemStateTitle:n(e.id),itemStateChecked:t,itemStateCommands:e.id!==l.LineOfSight?a:[]}}))).asMutable()),[c,n]),[d,u]=e.React.useState((()=>r(t.tools)));return e.React.useEffect((()=>{u(r(t.tools))}),[t.tools,r]),(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,{title:n("tools")},(0,e.jsx)(i.SettingRow,null,(0,e.jsx)("div",{className:"w-100"},(0,e.jsx)(f.List,{className:"w-100 py-1 pl-0 pr-1",itemsJson:d,isMultiSelection:!0,dndEnabled:!0,disableDoubleClickTitle:!0,onUpdateItem:(a,n)=>{const[,i]=a.itemJsons,o=[...i],s=[];a.updateType===f.TreeItemActionType.HandleCheckboxChanged?t.tools.forEach((e=>{o.forEach((t=>{const a=t.itemKey;e.id===a&&(e=e.setIn(["enable"],t.itemStateChecked),s.push(e))}))})):a.updateType===f.TreeItemActionType.HandleDidDrop&&o.forEach((e=>{const a=e.itemKey,n=t.tools.findIndex((e=>e.id===a));n>-1&&s.push(t.tools[n])})),t.onToolsConfigChanged((0,e.Immutable)(s))}})))))}));function j(t){return e.css`
    .side-popper-container{
      padding-top: 0;

      .side-popper {
        .numeric-input {
          width: 56px; /* ,#10453 */
        }

        .first-setting-section {
          padding-top: 0;
        }

        .jimu-widget-setting--section {
          padding-left: 0;
          padding-right: 0;
        }
      }

      /* Shadow cast */
      .shadow-cast-radios {
        color: ${t.colors.palette.dark[800]}
      }
    }
  `}const C=e.React.memo((t=>{const n=a.hooks.useTranslate(o,a.defaultMessages),s=t.onAcitvedChanged,l=e.React.useCallback((e=>{s(e)}),[s]);return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,null,(0,e.jsx)(i.SettingRow,{label:n("activedOnLoad")},(0,e.jsx)(a.Switch,{"aria-label":n("activedOnLoad"),checked:t.toolConfig.activedOnLoad,onChange:e=>{l(e.target.checked)}}))))})),v=e.React.memo((t=>{const n=a.hooks.useTranslate(o,a.defaultMessages),s=e.React.useMemo((()=>({timeSliderStepsDefault:5,timeSliderStepsMax:120,timeSliderStepsMin:1,speedDefault:1,speedMax:10,speedMin:.1})),[]),{onSettingChanged:l,hanldeToolSettingChanged:d}=t,u=t.toolConfig.config,g=e.React.useCallback(((e,a)=>{l(d(t.toolConfig,e,a))}),[t.toolConfig,l,d]),m=e.React.useCallback(((e,t)=>{t&&g({dateOrSeason:e})}),[g]),p=e.React.useCallback((e=>{let t={playButtons:e};!e&&u.dateTimeAutoPlay&&(t=Object.assign(Object.assign({},t),{dateTimeAutoPlay:!1})),g(t)}),[g,u.dateTimeAutoPlay]),h=[r.SyncedWithMap,r.Spring,r.Summer,r.Fall,r.Winter];return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,{className:"first-setting-section"},(0,e.jsx)(i.SettingRow,{label:n("timezoneSelector")},(0,e.jsx)(a.Switch,{"aria-label":n("timezoneSelector"),checked:u.timezone,onChange:e=>{g({timezone:e.target.checked})}})),(0,e.jsx)(i.SettingRow,{label:n("timeSliderSteps")},(0,e.jsx)(a.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:u.timeSliderSteps,defaultValue:s.timeSliderStepsDefault,min:s.timeSliderStepsMin,max:s.timeSliderStepsMax,step:1,precision:0,onChange:e=>{g({timeSliderSteps:e})},required:!0})),(0,e.jsx)(i.SettingRow,{label:n("dateSelector")},(0,e.jsx)(a.Switch,{"aria-label":n("dateSelector"),checked:u.datePicker,onChange:e=>{g({datePicker:e.target.checked})}})),u.datePicker&&(0,e.jsx)(i.SettingRow,null,(0,e.jsx)("div",{className:"d-block"},(0,e.jsx)("div",{className:"d-flex align-items-center mb-2"},(0,e.jsx)(a.Label,{className:"d-flex align-items-center"},(0,e.jsx)(a.Radio,{name:"dateOrSeason",className:"mr-2",checked:u.dateOrSeason===c.Date,onChange:(e,t)=>{m(c.Date,t)}}),n("date"))),(0,e.jsx)("div",{className:"d-flex align-items-center"},(0,e.jsx)(a.Label,{className:"d-flex align-items-center"},(0,e.jsx)(a.Radio,{name:"dateOrSeason",className:"mr-2",checked:u.dateOrSeason===c.Season,onChange:(e,t)=>{m(c.Season,t)}}),n("season"))))),u.dateOrSeason===c.Season&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingRow,{label:n("defaultSeason")}),(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(a.Select,{size:"sm",value:u.currentSeason,onChange:e=>g({currentSeason:e.target.value}),className:""},h.map(((t,a)=>{const i=n(t);return(0,e.jsx)("option",{key:a,value:t},i)}))))),(0,e.jsx)(i.SettingRow,{label:n("enablePlayControl")},(0,e.jsx)(a.Switch,{"aria-label":n("enablePlayControl"),checked:u.playButtons,onChange:e=>{p(e.target.checked)}})),u.playButtons&&u.dateOrSeason===c.Date&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingRow,{label:n("autoPlay")},(0,e.jsx)(a.Switch,{"aria-label":n("autoPlay"),checked:u.dateTimeAutoPlay,onChange:e=>{g({dateTimeAutoPlay:e.target.checked})}})),(0,e.jsx)(i.SettingRow,{label:n("daytimePlaySpeed")},(0,e.jsx)(a.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:u.playSpeedMultiplier,defaultValue:s.speedDefault,min:s.speedMin,max:s.speedMax,step:.5,onChange:e=>{g({playSpeedMultiplier:e})},required:!0}))),(0,e.jsx)(i.SettingRow,{label:n("dateTimeOption")},(0,e.jsx)(a.Switch,{"aria-label":n("dateTimeOption"),checked:u.dateTimeToggle,onChange:e=>{g({dateTimeToggle:e.target.checked})}})),(0,e.jsx)(i.SettingRow,{label:n("shadowOption")},(0,e.jsx)(a.Switch,{"aria-label":n("shadowOption"),checked:u.isShowShadows,onChange:e=>{g({isShowShadows:e.target.checked})}}))),(0,e.jsx)(C,{toolConfig:t.toolConfig,onAcitvedChanged:e=>g(null,e)}))})),w=e.React.memo((t=>{const n=a.hooks.useTranslate(o,a.defaultMessages),{onSettingChanged:s,hanldeToolSettingChanged:l}=t,c=e.React.useCallback(((e,a)=>{s(l(t.toolConfig,e,a))}),[t.toolConfig,s,l]),[r,u]=e.React.useState(!1),g=()=>{u(!r)},[m,p]=e.React.useState(!1),h=()=>{p(!m)},[f,S]=e.React.useState(!1),x=()=>{S(!f)},[y,j]=e.React.useState(!1),v=()=>{j(!y)},[w,b]=e.React.useState(!1),I=()=>{b(!w)},R=[d.Sunny,d.Cloudy,d.Rainy,d.Snowy,d.Foggy],N=t.toolConfig.config;return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,{className:"first-setting-section"},(0,e.jsx)(i.SettingRow,{label:n("defaultWeather")}),(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(a.Select,{size:"sm",value:N.weatherType,onChange:e=>c({weatherType:e.target.value}),className:""},R.map(((t,a)=>(0,e.jsx)("option",{key:a,value:t},n(t))))))),(0,e.jsx)(i.SettingSection,null,(0,e.jsx)(i.SettingRow,{label:n("defaultValues")}),(0,e.jsx)(i.SettingCollapse,{label:n("sunnyDay"),isOpen:r,onRequestOpen:g,onRequestClose:g,className:"my-3"},(0,e.jsx)(i.SettingRow,{label:n("cloudCover"),className:"mx-1 my-2"},(0,e.jsx)(a.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:N.sunnyConfig.cloudCover,defaultValue:.5,min:0,max:1,step:.1,onChange:e=>{c({sunnyConfig:{cloudCover:e}})},required:!0}))),(0,e.jsx)(i.SettingCollapse,{label:n("cloudyDay"),isOpen:m,onRequestOpen:h,onRequestClose:h,className:"my-3"},(0,e.jsx)(i.SettingRow,{label:n("cloudCover"),className:"mx-1 my-2"},(0,e.jsx)(a.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:N.cloudyConfig.cloudCover,defaultValue:.5,min:0,max:1,step:.1,onChange:e=>{c({cloudyConfig:{cloudCover:e}})},required:!0}))),(0,e.jsx)(i.SettingCollapse,{label:n("rainyDay"),isOpen:f,onRequestOpen:x,onRequestClose:x,className:"my-3"},(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingRow,{label:n("cloudCover"),className:"mx-1 my-2"},(0,e.jsx)(a.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:N.rainyConfig.cloudCover,defaultValue:.5,min:0,max:1,step:.1,onChange:e=>{c({rainyConfig:Object.assign(Object.assign({},N.rainyConfig),{cloudCover:e})})},required:!0})),(0,e.jsx)(i.SettingRow,{label:n("precipitation"),className:"mx-1 my-2"},(0,e.jsx)(a.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:N.rainyConfig.precipitation,defaultValue:.5,min:0,max:1,step:.1,onChange:e=>{c({rainyConfig:Object.assign(Object.assign({},N.rainyConfig),{precipitation:e})})},required:!0})))),(0,e.jsx)(i.SettingCollapse,{label:n("snowyDay"),isOpen:y,onRequestOpen:v,onRequestClose:v,className:"my-3"},(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingRow,{label:n("cloudCover"),className:"mx-1 my-2"},(0,e.jsx)(a.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:N.snowyConfig.cloudCover,defaultValue:.5,min:0,max:1,step:.1,onChange:e=>{c({snowyConfig:Object.assign(Object.assign({},N.snowyConfig),{cloudCover:e})})},required:!0})),(0,e.jsx)(i.SettingRow,{label:n("precipitation"),className:"mx-1 my-2"},(0,e.jsx)(a.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:N.snowyConfig.precipitation,defaultValue:.5,min:0,max:1,step:.1,onChange:e=>{c({snowyConfig:Object.assign(Object.assign({},N.snowyConfig),{precipitation:e})})},required:!0})))),(0,e.jsx)(i.SettingCollapse,{label:n("foggyDay"),isOpen:w,onRequestOpen:I,onRequestClose:I,className:"my-3"},(0,e.jsx)(i.SettingRow,{label:n("fogStrength"),className:"mx-1 my-2"},(0,e.jsx)(a.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:N.foggyConfig.fogStrength,defaultValue:.5,min:0,max:1,step:.1,onChange:e=>{c({foggyConfig:{fogStrength:e}})},required:!0})))),(0,e.jsx)(C,{toolConfig:t.toolConfig,onAcitvedChanged:e=>c(null,e)}))})),b=e.React.memo((t=>{const n=a.hooks.useTranslate(o,a.defaultMessages),{onSettingChanged:s,hanldeToolSettingChanged:l}=t,c=e.React.useCallback(((e,a)=>{s(l(t.toolConfig,e,a))}),[t.toolConfig,s,l]),r=e.React.useCallback(((e,a)=>{a&&c(Object.assign(Object.assign({},t.toolConfig.config),{visType:e}))}),[c,t.toolConfig]),d=t.toolConfig.config;return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,{className:"first-setting-section"},(0,e.jsx)(i.SettingRow,{label:n("defaultAnalysisType")}),(0,e.jsx)(i.SettingRow,null,(0,e.jsx)("div",{className:"d-block shadow-cast-radios"},(0,e.jsx)("div",{className:"d-flex align-items-center mb-2"},(0,e.jsx)(a.Label,{className:"d-flex align-items-center"},(0,e.jsx)(a.Radio,{name:"defaultAnalysisType",className:"mr-2",checked:d.visType===u.Threshold,onChange:(e,t)=>r(u.Threshold,t)}),n(u.Threshold))),(0,e.jsx)("div",{className:"d-flex align-items-center mb-2"},(0,e.jsx)(a.Label,{className:"d-flex align-items-center"},(0,e.jsx)(a.Radio,{name:"defaultAnalysisType",className:"mr-2",checked:d.visType===u.Duration,onChange:(e,t)=>r(u.Duration,t)}),n(u.Duration))),(0,e.jsx)("div",{className:"d-flex align-items-center"},(0,e.jsx)(a.Label,{check:!0,className:"d-flex align-items-center"},(0,e.jsx)(a.Radio,{name:"defaultAnalysisType",className:"mr-2",checked:d.visType===u.Discrete,onChange:(e,t)=>r(u.Discrete,t)}),n(u.Discrete))))),(0,e.jsx)(i.SettingRow,{label:n("timezoneSelector")},(0,e.jsx)(a.Switch,{"aria-label":n("timezoneSelector"),checked:d.timezone,onChange:e=>{c({timezone:e.target.checked})}})),(0,e.jsx)(i.SettingRow,{label:n("dateSelector")},(0,e.jsx)(a.Switch,{"aria-label":n("dateSelector"),checked:d.datePicker,onChange:e=>{c({datePicker:e.target.checked})}}))),(0,e.jsx)(C,{toolConfig:t.toolConfig,onAcitvedChanged:e=>c(null,e)}))})),I=e.React.memo((t=>{const{onSettingChanged:a,hanldeToolSettingChanged:n}=t,o=e.React.useCallback(((e,i)=>{a(n(t.toolConfig,e,i))}),[t.toolConfig,a,n]);return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,{className:"first-setting-section"},(0,e.jsx)(i.SettingRow,null)),(0,e.jsx)(C,{toolConfig:t.toolConfig,onAcitvedChanged:e=>o(null,e)}))}));var R=p(26826),N=p(58290);function M(t){return e.css`
    .panel-header {
      background:${t.colors.palette.light[300]};
      color:${t.colors.palette.dark[600]};
      height: 50px;
      flex-shrink: 0;
      font-size: 1rem;
      font-weight: 500;
      .jimu-btn {
        color: ${t.colors.palette.dark[600]} !important;
      }
      & >.actions >.jimu-btn.action-close :hover {
        color: ${t.colors.black} !important;
      }
    }
  `}function k(t){return e.css`
      .popper-content {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;

        .popper-header {
          width: 100%;
          flex-shrink: 0;
          flex-grow: 0;
          cursor: move;
        }
        .map-container {
          width: 800px;
          height: 800px;
          background-color: gray;
          display: contents;
        }
        .popper-footer {
          display: flex;
          background:${t.colors.palette.light[300]};
          color:${t.colors.palette.dark[600]};
          padding: ${e.polished.rem(10)} ${e.polished.rem(20)};

          .left-tool {
            min-height: 32px;
          }
          .right-tools{
            height: 45px;
            padding: 6px 2px;
            margin-left: auto;

            .jimu-btn {
              min-width: 80px;
            }
          }
        }
      }
  `}var P=p(29962),O=p(74871),D=p(67489),T=p(135),A=p(79964),W=p.n(A);const z=t=>{const a=window.SVG,{className:n}=t,i=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a}(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:o,src:W()},i)):e.React.createElement("svg",Object.assign({className:o},i))},B=e.React.memo((n=>{const i=(0,t.useTheme)(),s=a.hooks.useTranslate(o,a.defaultMessages),l=s("confirmInfo"),c=s("yesBtn"),r=s("commonModalCancel");return(0,e.jsx)("div",{css:e.css`
        position: absolute;
        z-index: 11;
        top: 0;
        left: 0;
        background-color: ${e.polished.rgba(i.colors.palette.secondary[400],.65)};
        width: ${n.innerSize.width}px;
        height: ${n.innerSize.height}px;
        .real-container{
          background-color: ${i.colors.palette.secondary[300]};
          border: 1px solid ${i.colors.palette.secondary[800]};
          background-clip: padding-box;
          width: 480px;
          position: relative;
          top: 50%;
          margin: -60px auto 0;
        }
        .confirm-header {
          border-bottom: 1px solid ${i.colors.palette.light[800]};
          padding: 16px 20px;
        }
        .confirm-context {
          padding: ${e.polished.rem(20)} ${e.polished.rem(20)} 0 ${e.polished.rem(20)};

          .title-icon {
            padding: 0 6px;
          }
          .message {
            margin-top: 1rem;
          }
        }
        .confirm-footer {
          display: flex;
          justify-content: flex-end;
          padding: ${e.polished.rem(20)};
          button {
            cursor: pointer;
            margin-left: ${e.polished.rem(8)};
            min-width: ${e.polished.rem(100)};
          }
        }
      `},(0,e.jsx)("div",{className:"real-container"},(0,e.jsx)("div",{className:"confirm-context"},(0,e.jsx)("div",{className:"message d-flex"},(0,e.jsx)("div",{className:"title-icon"},(0,e.jsx)(z,{size:"l",color:"var(--warning-600)"})),(0,e.jsx)("div",{css:e.css`color: var(--dark-800);`,"data-testid":"confirmInfo"},l))),(0,e.jsx)("div",{className:"confirm-footer"},(0,e.jsx)(a.Button,{type:"primary",onClick:n.onConfirmWinYes},c),(0,e.jsx)(a.Button,{type:"secondary",onClick:n.onConfirmWinCancel},r))))})),Z=e.React.memo((t=>{const n=a.hooks.useTranslate(o,a.defaultMessages),{jimuMapViewState:i,apiLoadedState:s,getSliceViewModel:l,isSavedFlagState:c,setIsSavedFlagState:r,resetSliceWidget:d,onPresetAnalysisChange:u,setPresetAnalysisInConfig:g,clearPresetAnalysisInConfig:m}=t,p=e.React.useCallback((()=>{let e=null;const t=l();"sliced"===t.state&&t.shape&&(e=t.shape.toJSON());let a="";e&&(a=JSON.stringify(e));const n=i.view.viewpoint.toJSON(),o={analysis:a,mapViewId:i.dataSourceId,viewpoint:n};let s;r(!0),s=e?g(o):m(),u(s)}),[i,l,r,u,g,m]),h=e.React.useCallback((()=>{r(!1),d(!1)}),[r,d]);return(0,e.jsx)("div",{className:"right-tools"},(0,e.jsx)(a.Button,{type:"primary",className:"mx-1",onClick:p,disabled:!s||!!c},n(c?"savedState":"savePopper")),(0,e.jsx)(a.Button,{type:"secondary",className:"mx-1",onClick:h,disabled:!s},n("clear")))})),V=t=>{const a=(t=>{var a;const n=document.querySelector(`iframe[name="${e.APP_FRAME_NAME_IN_BUILDER}"]`);return n?(null!==(a=n.contentDocument)&&void 0!==a?a:n.contentWindow.document).querySelector(t):null})(`div.widget-renderer[data-widgetid="${t}"]`),n=document.querySelector("#default")?document.querySelector("#default").clientHeight-20:1080;let i={width:770,height:850},o={width:770,height:770};if(a){const e=a.getBoundingClientRect();let t=e.width/e.height;t=t>0?t:1;let s=1.1*e.width,l=1.1*e.height+111,c=1.1*e.width,r=1.1*e.height;s<770?(s=770,l=770/t+111,c=770,r=770/t):s>1080&&(s=1080,l=1080/t+111,c=1080,r=1080/t),l>n&&(l=n,s=(n-111)*t>770?(n-111)*t:770),r>n-111&&(r=n-111,c=(n-111)*t),i={width:s,height:l},o={width:c-2,height:r}}return{innerSize:i,innerMapSize:o}},L=t=>{const a=(0,e.getAppStore)().getState().appStateInBuilder.appContext.isRTL;let n={x:500,y:50};const{innerSize:i}=V(t);return n={x:a?518:document.body.clientWidth-i.width-518,y:50},n},E=e.React.memo((n=>{const i=(0,t.useTheme)(),s=a.hooks.useTranslate(o,a.defaultMessages),l=e.React.useRef(null),c=e.React.useRef(null),r=e.React.useRef(null),d=e.React.useRef(null),u=e.React.useRef(null),g=e.React.useRef(null),m=e.React.useRef(null),[p,h]=e.React.useState(null),[f,S]=e.React.useState(!1),[x,y]=e.React.useState(!1),[j,C]=e.React.useState(!1),[v,w]=e.React.useState(!0),{getAnalysisFromConfig:b,setPresetAnalysisInConfig:I,clearPresetAnalysisInConfig:A,hasPresetAnalysisForThisMap:W,addAnalysesToView:z,removeAnalysesFromView:E}=(t=>{var a,n,i,o;const s=e.React.useCallback((()=>{var e;let a=null===(e=t.sliceConfig.analyses)||void 0===e?void 0:e.find((e=>{var a;return e.mapViewId===(null===(a=t.jimuMapView)||void 0===a?void 0:a.dataSourceId)}));return a||(a=null),a}),[t.sliceConfig,t.jimuMapView]),l=e.React.useCallback((()=>{let e=!1;return e=!(!t.sliceConfig.analyses||!s()),e}),[t.sliceConfig,s]),c=e.React.useCallback((()=>{var e;const t=null===(e=s())||void 0===e?void 0:e.mapViewId;return(null==t?void 0:t.startsWith("3d-toolbox-map-popper-"))?t.replace("3d-toolbox-map-popper-",""):t}),[s]),r=e.React.useCallback((()=>{var e;const t=null===(e=s())||void 0===e?void 0:e.viewpoint;return D.default.fromJSON(t)}),[s]),d=e.React.useCallback((e=>{let a=t.sliceConfig.analyses.filter((e=>e.mapViewId!==t.jimuMapView.dataSourceId));return a=a.concat(e),{analyses:a}}),[null===(a=t.jimuMapView)||void 0===a?void 0:a.dataSourceId,t.sliceConfig.analyses]),u=e.React.useCallback((()=>({analyses:t.sliceConfig.analyses.filter((e=>e.mapViewId!==t.jimuMapView.dataSourceId))})),[null===(n=t.jimuMapView)||void 0===n?void 0:n.dataSourceId,t.sliceConfig.analyses]),g=e.React.useCallback((e=>{let t=!1;return t=e===c(),t}),[c]),m=e.React.useCallback((e=>l()&&g(e)),[l,g]),p=e.React.useCallback((()=>{var e;let t=l(),a={},n=null;if(t){try{a=JSON.parse(null===(e=s())||void 0===e?void 0:e.analysis)}catch(e){t=!1,console.error(a)}const i=P.default.fromJSON(a);n=new O.default({shape:i})}return n}),[l,s]),h=e.React.useCallback(((e,a,n)=>{return i=void 0,o=void 0,l=function*(){var i,o;const s=null===(i=t.jimuMapView)||void 0===i?void 0:i.view;yield T.default.whenOnce((()=>!s.updating));const l=n===c();if(s&&"3d"===(null==s?void 0:s.type)&&l&&e&&s.analyses.add(a),l&&e){const e=r();e&&(null===(o=t.jimuMapView)||void 0===o||o.view.goTo(e))}},new((s=void 0)||(s=Promise))((function(e,t){function a(e){try{c(l.next(e))}catch(e){t(e)}}function n(e){try{c(l.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(a,n)}c((l=l.apply(i,o||[])).next())}));var i,o,s,l}),[null===(i=t.jimuMapView)||void 0===i?void 0:i.view,c,r]),f=e.React.useCallback((e=>{var a,n;const i=null===(a=t.jimuMapView)||void 0===a?void 0:a.view;i&&e&&(null===(n=i.analyses)||void 0===n||n.remove(e),e.destroy(),e=null)}),[null===(o=t.jimuMapView)||void 0===o?void 0:o.view]);return{hasPresetAnalysisForThisMap:m,getPresetMapViewIdInConfig:c,getPresetViewpointInConfig:r,setPresetAnalysisInConfig:d,clearPresetAnalysisInConfig:u,getAnalysisFromConfig:p,addAnalysesToView:h,removeAnalysesFromView:f}})({jimuMapView:p,sliceConfig:n.toolConfig.config});e.React.useEffect((()=>{f||(0,R.loadArcGISJSAPIModules)(["esri/core/reactiveUtils","esri/widgets/Slice","esri/widgets/Slice/SliceViewModel","esri/analysis/SlicePlane","esri/analysis/SliceAnalysis"]).then((e=>{[l.current,c.current,r.current,d.current,u.current]=e,S(!0)}))}),[f,S]);const F=e.React.useRef(null),H=e.React.useRef(null),G=e.React.useCallback((()=>{(null==F?void 0:F.current)&&(null==F||F.current.remove()),(null==H?void 0:H.current)&&(null==H||H.current.remove())}),[]),$=e.React.useCallback((e=>{F.current=null==l?void 0:l.current.watch((()=>"slicing"===(null==g?void 0:g.current.viewModel.state)),(()=>{w(!1)}));let t=!0;H.current=null==l?void 0:l.current.watch((()=>"sliced"===(null==g?void 0:g.current.viewModel.state)),(()=>{let a=!1;e&&t&&(a=!0),t=!1,a||w(!1)}))}),[]),J=e.React.useCallback((e=>{G(),E(m.current),m.current=null,g.current&&g.current.destroy();const t=null==p?void 0:p.view,a={view:t,tiltEnabled:n.toolConfig.config.tiltEnabled,excludeGroundSurface:n.toolConfig.config.excludeGroundSurface},i=e&&W(null==p?void 0:p.dataSourceId);i&&(m.current=b(),a.analysis=m.current),g.current=new c.current({view:t,viewModel:new r.current(a)}),g.current.when((()=>{i?z(i,m.current,null==p?void 0:p.dataSourceId):g.current.viewModel.start(),$(i)}))}),[null==p?void 0:p.dataSourceId,null==p?void 0:p.view,n.toolConfig.config,G,$,W,b,z,E]);e.React.useEffect((()=>{p&&f&&x&&J(!0)}),[p,f,x,J]);const{onShowMapPopperChange:q}=n,Q=e.React.useCallback((()=>{v?q(!1):C(!0)}),[q,v]);a.hooks.useUnmount((()=>{G(),g.current&&g.current.destroy()}));const _=n.useMapWidgetIds&&n.useMapWidgetIds[0],Y=(0,e.getAppStore)().getState().appStateInBuilder.appConfig;if(!Y.widgets[_])return null;const K=Y.widgets[_].useDataSources,U=(0,e.Immutable)({}).set("toolConfig",{canZoom:!0,canHome:!0,canCompass:!0,canLayers:!0});return(0,e.jsx)("div",{className:"w-100"},n.isShowMapPopper&&(0,e.jsx)(a.FloatingPanel,{onHeaderClose:Q,defaultPosition:L(n.useMapWidgetIds[0]),headerTitle:s("setDefaultSlice"),size:V(n.useMapWidgetIds[0]).innerSize,minSize:{width:770,height:850},disableResize:!0,css:M(i),className:"surface-3",disableActivateOverlay:!0,dragBounds:"body",autoFocus:!1},(0,e.jsx)("div",{className:"rounded w-100 h-100",css:k},(0,e.jsx)("div",{className:"popper-content"},(0,e.jsx)("div",{className:"map-container",style:{height:"600px",width:"700px"}},(0,e.jsx)(N.JimuMap,{id:n.specifiedJimuMapId,useDataSources:K,jimuMapConfig:U,onActiveViewChange:e=>{var t;e!==p&&("3d"===(null===(t=e.view)||void 0===t?void 0:t.type)?y(!0):y(!1)),h(e)},onViewGroupCreate:e=>{}})),j&&(0,e.jsx)(B,{innerSize:V(n.useMapWidgetIds[0]).innerSize,onConfirmWinYes:()=>{q(!1)},onConfirmWinCancel:()=>{C(!1)}}),(0,e.jsx)("div",{className:"popper-footer d-flex"},(0,e.jsx)(Z,{jimuMapViewState:p,apiLoadedState:f,getSliceViewModel:()=>g.current.viewModel,isSavedFlagState:v,setIsSavedFlagState:w,resetSliceWidget:J,setPresetAnalysisInConfig:I,clearPresetAnalysisInConfig:A,onPresetAnalysisChange:n.onPresetAnalysisChange}))))))}));var F=p(59216),H=p.n(F);const G=t=>{const a=window.SVG,{className:n}=t,i=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a}(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:o,src:H()},i)):e.React.createElement("svg",Object.assign({className:o},i))},$=e.React.memo((t=>{const n=a.hooks.useTranslate(o,a.defaultMessages),{onSettingChanged:s,hanldeToolSettingChanged:l}=t,c=t.toolConfig.config,r=e.React.useCallback(((e,a)=>{s(l(t.toolConfig,e,a))}),[t.toolConfig,s,l]),[d,u]=e.React.useState(!1);a.hooks.useUnmount((()=>{u(!1)}));const g=e.React.useCallback((e=>{u(e)}),[]);return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,{className:"first-setting-section"},(0,e.jsx)(i.SettingRow,{label:n("tiltEnabled")},(0,e.jsx)(a.Switch,{"aria-label":n("tiltEnabled"),checked:c.tiltEnabled,onChange:e=>{r({tiltEnabled:e.target.checked})}})),(0,e.jsx)(i.SettingRow,{label:n("excludeGroundSurface")},(0,e.jsx)(a.Switch,{"aria-label":n("excludeGroundSurface"),checked:c.excludeGroundSurface,onChange:e=>{r({excludeGroundSurface:e.target.checked})}})),(0,e.jsx)(i.SettingRow,{label:n("defaultSlice")},(0,e.jsx)(a.Button,{type:"tertiary",icon:!0,onClick:()=>{u(!0)}},(0,e.jsx)(G,null))),d&&(0,e.jsx)(E,{isShowMapPopper:d,onShowMapPopperChange:g,useDataSources:t.useDataSources,useMapWidgetIds:t.useMapWidgetIds,specifiedJimuMapId:"3d-toolbox-map-popper",toolConfig:t.toolConfig,onPresetAnalysisChange:e=>{r(e)}})),(0,e.jsx)(C,{toolConfig:t.toolConfig,onAcitvedChanged:e=>r(null,e)}))})),J=e.React.memo((n=>{const s=(0,t.useTheme)(),c=a.hooks.useTranslate(o,a.defaultMessages),r=e.React.useCallback((e=>{const t=n.toolsConfig.find((t=>t.id===e));return t&&t.config?t:null}),[n.toolsConfig]),d=e.React.useCallback(((e,t,a)=>{const n=Object.assign({},e);return t&&(n.config=Object.assign(Object.assign({},n.config),t)),void 0!==a&&(n.activedOnLoad=a),n}),[]),u=n.onSettingChanged,g=e.React.useCallback(((t,a)=>{const i=n.toolsConfig.findIndex((e=>e.id===t));if(i>-1){const t=e.Immutable.setIn(n.toolsConfig,[i.toString()],a);u(t)}}),[u,n.toolsConfig]),m=c(n.shownMode?n.shownMode:"tools");return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SidePopper,{title:m,css:j(s),isOpen:null!==n.shownMode,toggle:()=>n.onSidePopperClose(),trigger:null,position:"right"},(0,e.jsx)(i.SettingSection,{className:"side-popper-container"},(0,e.jsx)("div",{className:"side-popper"},n.shownMode===l.Daylight&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(v,{toolConfig:r(l.Daylight),hanldeToolSettingChanged:d,onSettingChanged:e=>{g(l.Daylight,e)}})),n.shownMode===l.Weather&&(0,e.jsx)(w,{toolConfig:r(l.Weather),hanldeToolSettingChanged:d,onSettingChanged:e=>{g(l.Weather,e)}}),n.shownMode===l.ShadowCast&&(0,e.jsx)(b,{toolConfig:r(l.ShadowCast),hanldeToolSettingChanged:d,onSettingChanged:e=>{g(l.ShadowCast,e)}}),n.shownMode===l.LineOfSight&&(0,e.jsx)(I,{toolConfig:r(l.LineOfSight),hanldeToolSettingChanged:d,onSettingChanged:e=>{g(l.LineOfSight,e)}}),n.shownMode===l.Slice&&(0,e.jsx)($,{toolConfig:r(l.Slice),hanldeToolSettingChanged:d,onSettingChanged:e=>{g(l.Slice,e)},useMapWidgetIds:n.useMapWidgetIds,useDataSources:n.useDataSources})))))})),q=e.React.memo((t=>{const n=a.hooks.useTranslate(o,a.defaultMessages),s=t.onChange,l=e.React.useCallback((e=>{s(Object.assign(Object.assign({},t.arrangement),{style:e}))}),[s,t.arrangement]),c=e.React.useCallback((e=>{s(Object.assign(Object.assign({},t.arrangement),{direction:e?m.Vertical:m.Horizontal}))}),[s,t.arrangement]),r=n("arrangementStyle"),d=t.widgetId+"-uimode-description",u=t.widgetId+"-uimode-0",h=t.widgetId+"-uimode-1";return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,{title:r},(0,e.jsx)(i.SettingRow,null,(0,e.jsx)("div",{className:"ui-mode-card-chooser"},(0,e.jsx)(a.Label,{className:"d-flex flex-column ui-mode-card-wapper"},(0,e.jsx)(a.Button,{icon:!0,className:(0,e.classNames)("ui-mode-card",{active:t.arrangement.style===g.List}),onClick:()=>l(g.List),"aria-labelledby":u,"aria-describedby":d},(0,e.jsx)(a.Icon,{width:92,height:56,icon:p(99142),autoFlip:!0})),(0,e.jsx)("div",{id:u,className:"mx-1 text-break ui-mode-label"},n("listMode"))),(0,e.jsx)("div",{className:"ui-mode-card-separator"}),(0,e.jsx)(a.Label,{className:"d-flex flex-column ui-mode-card-wapper"},(0,e.jsx)(a.Button,{icon:!0,className:(0,e.classNames)("ui-mode-card",{active:t.arrangement.style===g.Icon}),onClick:()=>l(g.Icon),"aria-labelledby":h,"aria-describedby":d},(0,e.jsx)(a.Icon,{width:92,height:56,icon:p(67113),autoFlip:!0})),(0,e.jsx)("div",{id:h,className:"mx-1 text-break ui-mode-label"},n("iconMode")))))),t.arrangement.style===g.Icon&&(0,e.jsx)(i.SettingSection,null,(0,e.jsx)(i.SettingRow,{label:n("direction")},(0,e.jsx)(i.DirectionSelector,{vertical:t.arrangement.direction===m.Vertical,onChange:c}))))}));var Q=p(748),_=p.n(Q);const Y=t=>{const a=window.SVG,{className:n}=t,i=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a}(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:o,src:_()},i)):e.React.createElement("svg",Object.assign({className:o},i))},K=l=>{const c=(0,t.useTheme)(),r=a.hooks.useTranslate(o,a.defaultMessages),d=e.ReactRedux.useSelector((e=>{var t,a;let n;return n=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,{appConfig:n,layoutInfo:null===(a=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.widgetsState[l.id])||void 0===a?void 0:a.layoutInfo}})),u=e.React.useMemo((()=>{var e;return(null===(e=l.useMapWidgetIds)||void 0===e?void 0:e.length)>0}),[l.useMapWidgetIds]),p={w:350,h:290},h={w:170,h:42},f={w:42,h:170},[S,x]=e.React.useState(null),j=(e,t)=>{t&&(C.current=t),x(e)},C=e.React.useRef(null);return e.React.useEffect((()=>{null===S&&(null==C?void 0:C.current)&&(C.current.focus(),C.current=null)}),[S]),(0,e.jsx)("div",{className:"widget-setting-directions jimu-widget-setting",css:s(c)},(0,e.jsx)(i.SettingSection,{title:r("selectMapWidget"),className:(0,e.classNames)({"border-0":!u})},(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(i.MapWidgetSelector,{onSelect:e=>{l.onSettingChange({id:l.id,useMapWidgetIds:e})},useMapWidgetIds:l.useMapWidgetIds}))),!u&&(0,e.jsx)("div",{className:"d-flex justify-content-center align-items-center placeholder-container"},(0,e.jsx)("div",{className:"text-center"},(0,e.jsx)(Y,{size:48,className:"d-inline-block placeholder-icon mb-2"}),(0,e.jsx)("p",{className:"placeholder-hint"},r("selectMapHint")))),u&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(y,{tools:l.config.tools,onToolsConfigChanged:e=>{l.onSettingChange({id:l.id,config:l.config.setIn(["tools"],e)})},onSidePopperToggle:j}),(0,e.jsx)(q,{widgetId:l.id,arrangement:l.config.arrangement,onChange:t=>{var a,i,o,s;let c=p;const{style:r,direction:u}=t;r===g.List?c=p:r===g.Icon&&u===m.Horizontal?c=h:r===g.Icon&&u===m.Vertical&&(c=f);const S=null===(a=d.layoutInfo)||void 0===a?void 0:a.layoutId,x=null===(s=null===(o=null===(i=d.appConfig)||void 0===i?void 0:i.layouts)||void 0===o?void 0:o[S])||void 0===s?void 0:s.type;S&&x===e.LayoutType.FixedLayout&&(0,n.getAppConfigAction)().editLayoutItemSize(d.layoutInfo,c.w,c.h).exec(),l.onSettingChange({id:l.id,config:l.config.setIn(["arrangement"],t)})}}),(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(J,{toolsConfig:l.config.tools,shownMode:S,onSidePopperClose:()=>j(null),onSettingChanged:e=>{l.onSettingChange({id:l.id,config:l.config.setIn(["tools"],e)})},useMapWidgetIds:l.useMapWidgetIds,useDataSources:l.useDataSources}))))}})(),h})())}}}));